<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>getModelList.html</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css"
          integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz"
          crossorigin="anonymous">
    <link rel="stylesheet" href="/css/getModelList.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.5.1/nouislider.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
          crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.5.1/nouislider.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        table {
            width: 90%;
            border-collapse: collapse;
        }

        th, tr, td {
            border: 8px solid white;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body>
<header>header</header>

<section class="SubTitle">SELECT_MODEL</section>

<div class="div">
    <p id="SubTitle_text">간편한 비교, 편리한 선택</p>
</div>

<div class="div">
    <h3>with carini</h3>
</div>

<div style="height: 50px;"></div> <!--간격박스-->

<!-- 필터링 폼 -->
<form th:action="@{/model/getModelList}" method="get">
    <!-- Main -->
    <main>
        <div class="flex-container_row">
            <div class="flex-container_column">
                <div class="div">
                    <h3>- CAR THAT YOU WANT -</h3>
                </div>
                <div style="height: 15px;"></div> <!--간격박스-->

                <table>
                    <thead>
                    <th>구분</th>
                    <th>범위</th>
                    </thead>

                    <tbody>
                    <tr>
                        <td>가격범위</td>
                        <td>
                            <div>
                                <div id="priceSlider"></div>
                                <input type="hidden" class="form-control" id="filterMinPrice" name="filterMinPrice">
                                <input type="hidden" class="form-control" id="filterMaxPrice" name="filterMaxPrice">
                                <span id="priceDisplay" style="text-align: justify;">
                                    "filterMinPrice"원
                                    "filterMaxPrice"원
                                </span>
                            </div>
                            <script>
                                // priceSlider 초기화
                                var priceSlider = document.getElementById('priceSlider');
                                noUiSlider.create(priceSlider, {
                                    start: [0, 50000], // 시작 가격 범위
                                    connect: true,
                                    range: {
                                        'min': 0,
                                        'max': 50000
                                    }
                                });

                                // slider 값이 변경될 때마다 호출되는 함수
                                priceSlider.noUiSlider.on('update', function (values, handle) {
                                    var minPrice = Math.round(values[0]);
                                    var maxPrice = Math.round(values[1]);

                                    // input 태그 값 업데이트
                                    document.getElementById('filterMinPrice').value = minPrice;
                                    document.getElementById('filterMaxPrice').value = maxPrice;

                                    // 단위 변환 함수
                                    function formatPrice(price) {
                                        if (price >= 10000) {
                                            return Math.floor(price / 10000) + "억 " + (price % 10000) + "만원";
                                        }
                                        return price + "만원";
                                    }

                                    // span 태그 값 업데이트
                                    document.getElementById('priceDisplay').innerText = formatPrice(minPrice) + " - " + formatPrice(maxPrice);
                                });
                            </script>

                            <input type="checkbox"> 5억 이상 <!--자동차 가격이 너무 차이나서 5억 이상은 따로 처리-->
                        </td>
                    </tr>

                    <tr>
                        <td>자동차 크기</td>
                        <td>
                            <select class="form-select" id="filterSize" name="filterSize">
                                <option value="" selected>선택안함</option>
                                <option>경형</option>
                                <option>소형</option>
                                <option>중형</option>
                                <option>준중형</option>
                                <option>대형</option>
                                <option>준대형</option>
                            </select>
                        </td>
                    </tr>

                    <tr>
                        <td>자동차 연료 타입</td>
                        <td>
                            <select class="form-select" id="filterFuel" name="filterFuel">
                                <option value="" selected>선택안함</option>
                                <option>가솔린</option>
                                <option>디젤</option>
                                <option>전기</option>
                                <option>하이브리드</option>
                                <option>LPG</option>
                            </select>
                        </td>
                    </tr>

                    <tr>
                        <td>정렬</td>
                        <td>
                            <select class="form-select" id="carSort" name="carSort">
                                <option value="low" selected>저가순</option>
                                <option value="high">고가순</option>
                                <option value="name">이름순</option>
                            </select>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <div style="height: 50px;"></div> <!--간격박스-->

                <button type="submit" style="font-size: 25px; letter-spacing: 5px; font-weight: 100;">FILTER</button>

                <div style="height: 50px;"></div> <!--간격박스-->
            </div>
        </div>
    </main>
</form>

<!-- 카드 박스 반복 -->
<div class="flex-container_row" style="width: 150%; border: 1px solid whitesmoke;">
    <div class="card_box" id="first_card_box" th:each="car : ${carList}">
        <div class="card" style="width: 18rem; max-height: 23rem;">
            <a href="#" th:onclick="'selectCarForComparison(' + ${car.carId} + ')'" style="cursor: pointer;" id="goToComparison">
                <img th:src="@{${car.carImg}}" class="card-img-top" alt="이미지">
            </a>
            <div class="card-body">
                <h5 class="card-title" style="font-size: 20px;" th:text="${car.carName}"></h5>
                <p class="card-text" style="font-size: 15px; height: 10px; margin-top: 10px;" th:text="'가격 : ' + ${#numbers.formatInteger(car.carAvgPrice, 0, 'COMMA')} + '만원'"></p>
                <p class="card-text" style="font-size: 15px; height: 10px;" th:text="'크기 : ' + ${car.carSize}"></p>
                <p class="card-text" style="font-size: 15px; height: 10px;" th:text="'연료 : ' + ${car.carFuel}"></p>
                <p class="card-text" style="font-size: 15px; height: 10px;" th:text="'연비 : ' + ${car.carEff}"></p>
                <div class="card_button_box" style="margin-top: 20px; font-size: 15px;">
                    <a th:href="@{/model/getModel(carId=${car.carId})}" style="padding: 0px 5px;" class="btn">자세히 보기</a>
                    <img th:src="${car.isBookmarked} ? @{/img/bookmarked.png} : @{/img/unbookmarked.png}"
                         th:alt="${car.isBookmarked} ? '즐겨찾기 삭제' : '즐겨찾기 추가'"
                         th:onclick="'toggleBookmark(' + ${car.carId} + ',' + ${car.isBookmarked} + ')'"
                         style="cursor: pointer; width: 16px; height: 16px;" alt="즐겨찾기 버튼">
                </div>
            </div>
        </div>
    </div>
</div>

<!-- pagination -->
<div>
    <ul class="col pagination justify-content-center">
        <th:block th:if="${pagingInfo.startPage > pagingInfo.pageSize}">
            <li class="page-item">
                <a th:href="@{/model/getModelList(curPage=${pagingInfo.startPage - pagingInfo.pageSize}, rowSizePerPage=${pagingInfo.rowSizePerPage}, searchType=${pagingInfo.searchType}, searchWord=${pagingInfo.searchWord})}"
                   th:text="#{page.prev}"></a>
            </li>
        </th:block>

        <th:block th:each="page : ${#numbers.sequence(pagingInfo.startPage, pagingInfo.endPage)}">
            <li class="page-item" th:classappend="${(page-1) == pagingInfo.curPage ? 'active' : ''}">
                <a th:classappend="${(page-1) == pagingInfo.curPage ? 'current' : ''}"
                   th:href="@{/model/getModelList(curPage=${page-1}, rowSizePerPage=${pagingInfo.rowSizePerPage}, searchType=${pagingInfo.searchType}, searchWord=${pagingInfo.searchWord})}"
                   th:text="${page}"></a>
            </li>
        </th:block>

        <th:block th:if="${pagingInfo.endPage < pagingInfo.totalPages}">
            <li class="page-item">
                <a th:href="@{/model/getModelList(curPage=${pagingInfo.endPage}, rowSizePerPage=${pagingInfo.rowSizePerPage}, searchType=${pagingInfo.searchType}, searchWord=${pagingInfo.searchWord})}"
                   th:text="#{page.next}"></a>
            </li>
        </th:block>
    </ul>
</div>

<hr/>

<!-- Comparison Section -->
<div id="comparisonSection" style="margin-top: 30px; display: block;">
    <div class="div">
        <h3>- CAR COMPARISON -</h3>
    </div>
    <table>
        <thead>
        <tr>
            <td>
                <span id="car1Name" style="font-weight: bold;"></span>
                <a href="#" onclick="removeCarFromComparison(1)">
                    <img src="/img/cancel.png" alt="삭제" style="height: 16px; width: 16px; opacity: 0.5;"/>
                </a>
            </td>
            <th></th>
            <td>
                <span id="car2Name" style="font-weight: bold;"></span>
                <a href="#" onclick="removeCarFromComparison(2)">
                    <img src="/img/cancel.png" alt="삭제" style="height: 16px; width: 16px; opacity: 0.5;"/>
                </a>
            </td>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td><img id="car1Img" class="img-fluid" alt="이미지"></td>
            <td style="padding: 1% 1%;">이미지</td>
            <td><img id="car2Img" class="img-fluid" alt="이미지"></td>
        </tr>
        <tr>
            <td><span id="car1Price"></span>만원</td>
            <td style="padding: 1% 1%;">가격</td>
            <td><span id="car2Price"></span>만원</td>
        </tr>
        <tr>
            <td id="car1Size"></td>
            <td style="padding: 1% 1%;">크기</td>
            <td id="car2Size"></td>
        </tr>
        <tr>
            <td id="car1Fuel"></td>
            <td style="padding: 1% 1%;">연료</td>
            <td id="car2Fuel"></td>
        </tr>
        <tr>
            <td id="car1Eff"></td>
            <td style="padding: 1% 1%;">연비</td>
            <td id="car2Eff"></td>
        </tr>
        <tr id="carRadarChart">
            <td text-align: center;>
                <canvas id="car1RadarChart"></canvas>
            </td>
            <td style="padding: 1% 0%;">radarchart<br/>
                <button style="font-size: 14px;" onclick="combineRadarChart()">COMBINE</button>
            </td>
            <td>
                <canvas id="car2RadarChart"></canvas>
            </td>
        </tr>
        <tr id="carCombineRadarChartTR">
            <td colspan="3" style="text-align: center;">
                <canvas id="carCombineRadarChart"></canvas>
                <button style="font-size: 25px; letter-spacing: 5px; font-weight: 100; margin-left: 34%;"
                        onclick="returnChart()">RETURN
                </button>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<!-- Scripts -->
<script src="/js/getModelList.js"></script>

<footer>
    <hr>
    footer
</footer>

</body>
</html>
